import React,{createContext,useContext,useState,useEffect} from 'react'; import * as api from './api'; const C = createContext(); export function AuthProvider({children}){ const [user,setUser]=useState(()=>{try{return JSON.parse(localStorage.getItem('user'))}catch(e){return null}}); useEffect(()=>{ if(user) localStorage.setItem('user',JSON.stringify(user)); else localStorage.removeItem('user')},[user]); async function login(u,p){ const res=await api.login(u,p); localStorage.setItem('token',res.token); setUser(res.user)} async function register(payload){ const res=await api.register(payload); localStorage.setItem('token',res.token); setUser(res.user)} function logout(){localStorage.removeItem('token');setUser(null)} return <C.Provider value={{user,login,register,logout}}>{children}</C.Provider> } export function useAuth(){return useContext(C)}